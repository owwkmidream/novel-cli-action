# .github/workflows/main.yml

name: Sync Crate Source via Node.js script

on:
  schedule:
    - cron: '0 3 * * 1' # 每周一凌晨3点 (UTC)
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      # 1. 检出包含 sync.js 和 package.json 的仓库
      - name: Checkout self
        uses: actions/checkout@v3

      # 2. 设置 Node.js 环境
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '22' # 或者 20
          cache: 'npm'

      # 3. 安装依赖
      - name: Install dependencies
        run: npm install

      # 4. 运行同步脚本
      - name: Run sync script
        run: node sync.js
        env:
          # 要同步的 crate
          CRATE_NAME: novel-cli
          # 你的 GitHub 用户名或组织名
          GH_USER: ${{ github.repository_owner }} 
          # 你的仓库名 (自动获取)
          REPO_NAME: novel-cli-backup
          # 从 Secrets 中读取 PAT
          GH_PAT: ${{ secrets.GH_PAT }}